// Dash.js v0.3.0
// (c) 2011 Paul Colton
// See LICENSE file for licensing information or 
// visit http://dashjs.com
(function(){function c(){return((1+Math.random())*65536|0).toString(16).substring(1)}var d=this,g=function(b){var a=function(){};a.prototype=b;a=new a;a.__super__=b;return a},a=d.Dash=g(Backbone);a.VERSION="0.3.0";a.subclass=g;if(d.ich)a.template=g(d.ich);a.ready=function(b){if(a.ready.fired)b();else{if(!a.ready.callbacks)a.ready.callbacks=[];a.ready.callbacks.push(b)}};a.dashlink=function(b){var h=this;this.name=b;a.ready(function(){var b=a.io._dashlinkLoad(h.name);h.data=b&&JSON.parse(b)||{}})};
_.extend(a.dashlink.prototype,{save:function(){a.io._dashlinkSave(this.name,JSON.stringify(this.data))},create:function(b){if(!b.id)b.id=b.attributes.id=c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c();this.data[b.id]=b;this.save();return b},update:function(b){this.data[b.id]=b;this.save();return b},find:function(b){return this.data[b.id]},findAll:function(){return _.values(this.data)},destroy:function(b){delete this.data[b.id];this.save();return b}});a.__super__.sync=function(b,a,c,d){var e,f=a.dashlink||
a.collection.dashlink;switch(b){case "read":e=a.id?f.find(a):f.findAll();break;case "create":e=f.create(a);break;case "update":e=f.update(a);break;case "delete":e=f.destroy(a)}e?c(e):d("Record not found")};var j=function(){a.io=d.now;console&&console.log("Dash.js: Dash.io created.");a.template&&!a.template.loaded?a.io._getTemplates(function(b){_.each(b,function(b,c){a.template.addTemplate(c,b)});a.template.loaded=!0;i()}):i()},i=function(){if(a.ready.callbacks)for(var b=0;b<a.ready.callbacks.length;b++)(0,a.ready.callbacks[b])();
a.ready.fired=!0},k=function(){if(d.now&&d.nowLib){var a=d.nowLib.nowJSReady;d.nowLib.nowJSReady=function(){a();j()};j()}};$.getScript("/nowjs/now.js",function(){console&&console.log("Dash.js: nowjs loaded");now.ready(function(){a.io||k()})})})();
